{% extends 'base.html' %}

{% block title %}Upcoming Shifts - Admin{% endblock %}

{% block content %}
<style>
  :root{
    --primary: #5b8cff;
    --success: #36d399;
    --warning: #f6c34f;
    --danger:  #ff6b6b;
    --muted: #6b7280;
    --card-bg: #fff;
    --card-border: #e5e7eb;
    --card-radius: 14px;
  }

  body{
    background: #f9fafb;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    color: #111827;
  }

  .panel{
    background: var(--card-bg);
    border-radius: var(--card-radius);
    border: 1px solid var(--card-border);
    padding: 24px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    margin-bottom: 20px;
  }

  .table-light th{
    color: var(--muted);
    font-weight: 600;
    border-bottom: 2px solid var(--card-border);
    background: #f8fafc;
  }
  
  .table-light td{
    border-bottom: 1px solid #f1f1f1;
    vertical-align: middle;
  }

  .badge-soft{
    background: #f3f4f6;
    color: #374151;
    border-radius: 6px;
    padding: 4px 10px;
    font-size: .85rem;
    font-weight: 500;
  }

  .badge-available{
    background: #dcfce7;
    color: #166534;
  }

  .badge-full{
    background: #fee2e2;
    color: #991b1b;
  }

  .badge-partial{
    background: #fef3c7;
    color: #92400e;
  }

  .header-actions{
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .shift-title{
    font-weight: 600;
    color: #111827;
  }

  .shift-meta{
    color: var(--muted);
    font-size: 0.9rem;
  }
</style>

<div class="container-fluid">
  <div class="panel">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h3 class="mb-2">Upcoming Shifts</h3>
        <p class="text-muted mb-0">All future shifts for your organization</p>
      </div>
      <div class="header-actions">
        <a href="{% url 'create_shift' %}" class="btn btn-primary">
          <i class="fa fa-plus me-2"></i>Create Shift
        </a>
        <a href="{% url 'admin_manage_shifts' %}" class="btn btn-outline-secondary">
          <i class="fa fa-cog me-2"></i>Manage Shifts
        </a>
        <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary">
          <i class="fa fa-arrow-left me-2"></i>Back to Dashboard
        </a>
      </div>
    </div>

    {% if shifts %}
      <div class="table-responsive">
        <table class="table table-light align-middle">
          <thead>
            <tr>
              <th>Shift Details</th>
              <th>Date & Time</th>
              <th>Role</th>
              <th>Capacity</th>
              <th>Status</th>
              <th>Location</th>
            </tr>
          </thead>
          <tbody>
            {% for shift in shifts %}
            <tr>
              <td>
                <div class="shift-title">{{ shift.title }}</div>
                {% if shift.description %}
                  <div class="shift-meta">{{ shift.description|truncatechars:50 }}</div>
                {% endif %}
              </td>
              <td>
                <div class="fw-semibold">{{ shift.date|date:"M j, Y" }}</div>
                <div class="shift-meta">
                  {% if shift.start_time and shift.end_time %}
                    {{ shift.start_time|time:"H:i" }} - {{ shift.end_time|time:"H:i" }}
                  {% elif shift.start_time %}
                    From {{ shift.start_time|time:"H:i" }}
                  {% elif shift.end_time %}
                    Until {{ shift.end_time|time:"H:i" }}
                  {% else %}
                    <span class="text-muted">TBC</span>
                  {% endif %}
                </div>
              </td>
              <td>
                <span class="badge-soft">{{ shift.role }}</span>
              </td>
              <td>
                <div class="fw-semibold">{{ shift.booked_count }} / {{ shift.max_staff }}</div>
                <div class="progress mt-1" style="height: 6px;">
                  {% widthratio shift.booked_count 1 shift.max_staff as percentage %}
                  <div class="progress-bar 
                    {% if shift.booked_count >= shift.max_staff %}bg-danger
                    {% elif percentage >= 80 %}bg-warning
                    {% else %}bg-success{% endif %}" 
                    style="width: {% widthratio shift.booked_count 100 shift.max_staff %}%"></div>
                </div>
              </td>
              <td>
                {% if shift.booked_count >= shift.max_staff %}
                  <span class="badge-soft badge-full">
                    <i class="fa fa-times-circle me-1"></i>Full
                  </span>
                {% elif shift.booked_count > 0 %}
                  <span class="badge-soft badge-partial">
                    <i class="fa fa-clock-o me-1"></i>Partial
                  </span>
                {% else %}
                  <span class="badge-soft badge-available">
                    <i class="fa fa-check-circle me-1"></i>Available
                  </span>
                {% endif %}
              </td>
              <td>
                {% if shift.allowed_postcode %}
                  <div class="shift-meta">
                    <i class="fa fa-map-marker me-1"></i>{{ shift.allowed_postcode }}
                  </div>
                {% else %}
                  <span class="text-muted">No restriction</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
      <div class="mt-4 p-3 bg-light rounded">
        <div class="row text-center">
          <div class="col-md-4">
            <div class="fw-semibold">{{ total_shifts }}</div>
            <div class="text-muted small">Total Upcoming</div>
          </div>
          <div class="col-md-4">
            <div class="fw-semibold">{{ available_shifts }}</div>
            <div class="text-muted small">Available</div>
          </div>
          <div class="col-md-4">
            <div class="fw-semibold">{{ full_shifts }}</div>
            <div class="text-muted small">Full</div>
          </div>
        </div>
      </div>
      
    {% else %}
      <div class="text-center py-5">
        <div class="mb-3">
          <i class="fa fa-calendar-o fa-3x text-muted"></i>
        </div>
        <h5 class="text-muted">No Upcoming Shifts</h5>
        <p class="text-muted">There are no upcoming shifts scheduled for your organization.</p>
        <a href="{% url 'create_shift' %}" class="btn btn-primary">
          <i class="fa fa-plus me-2"></i>Create Your First Shift
        </a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
